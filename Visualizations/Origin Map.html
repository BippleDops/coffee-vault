<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Origin Exploration Map</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #faf7f2;
            color: #2b1810;
            padding: 1rem;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(43, 24, 16, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a7c59 0%, #6f4e37 100%);
            color: #faf7f2;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.25rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .map-container {
            position: relative;
            padding: 2rem;
            background: linear-gradient(180deg, #e8f4f0 0%, #faf7f2 100%);
            min-height: 600px;
        }

        #worldMap {
            width: 100%;
            height: auto;
            max-height: 600px;
        }

        .country {
            fill: #e0d5c7;
            stroke: #c4b5a0;
            stroke-width: 0.5;
            cursor: pointer;
            transition: all 0.2s;
        }

        .country:hover {
            fill: #d4b896;
        }

        .country.producing {
            fill: #a68860;
        }

        .country.producing:hover {
            fill: #8b6f47;
        }

        .country.producing.tried {
            fill: #4a7c59;
        }

        .country.producing.tried:hover {
            fill: #3d6647;
        }

        .country.producing.favorite {
            fill: #8b1e3f;
        }

        .country.producing.favorite:hover {
            fill: #6f1832;
        }

        .country-label {
            font-size: 11px;
            font-weight: 600;
            fill: #2b1810;
            pointer-events: none;
            text-anchor: middle;
        }

        .journey-line {
            fill: none;
            stroke: #d4af37;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            opacity: 0.6;
            animation: dash 20s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -100;
            }
        }

        .info-card {
            position: absolute;
            background: rgba(43, 24, 16, 0.95);
            color: #faf7f2;
            padding: 1.5rem;
            border-radius: 0.5rem;
            max-width: 350px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 100;
            box-shadow: 0 10px 15px rgba(43, 24, 16, 0.3);
        }

        .info-card.visible {
            opacity: 1;
        }

        .info-card h3 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: #d4af37;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-card .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .info-card .stat {
            text-align: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
        }

        .info-card .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d4af37;
        }

        .info-card .stat-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }

        .info-card .flavors {
            margin-top: 1rem;
        }

        .info-card .flavor-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: rgba(212, 175, 55, 0.3);
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin: 0.25rem 0.25rem 0.25rem 0;
        }

        .controls {
            padding: 1.5rem;
            background: #f4e8d8;
            border-bottom: 2px solid #e0d5c7;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6f4e37;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background: #c4b5a0;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle.active {
            background: #4a7c59;
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle.active::after {
            transform: translateX(24px);
        }

        .legend {
            padding: 1.5rem;
            background: #f4e8d8;
            border-top: 2px solid #e0d5c7;
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6f4e37;
        }

        .legend-box {
            width: 30px;
            height: 20px;
            border-radius: 0.25rem;
            border: 2px solid #6f4e37;
        }

        .stats-panel {
            padding: 2rem;
            background: white;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            padding: 1.5rem;
            background: #f4e8d8;
            border-radius: 0.5rem;
            text-align: center;
            border: 2px solid #e0d5c7;
        }

        .stat-card-value {
            font-size: 2rem;
            font-weight: bold;
            color: #6f4e37;
        }

        .stat-card-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #a0826d;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .map-container {
                padding: 1rem;
            }

            .info-card {
                max-width: 90%;
                left: 5% !important;
                right: 5% !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Coffee Origin Exploration Map</h1>
            <p>Discover the world of coffee through the countries you've explored</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Show Journey Lines</label>
                <div class="toggle" id="toggleJourney"></div>
            </div>
            <div class="control-group">
                <label>Show Labels</label>
                <div class="toggle active" id="toggleLabels"></div>
            </div>
        </div>

        <div class="map-container">
            <svg id="worldMap" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet"></svg>
            <div class="info-card" id="infoCard"></div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background: #e0d5c7;"></div>
                <span>Non-producing</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #a68860;"></div>
                <span>Producing (Not Tried)</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #4a7c59;"></div>
                <span>Tried</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #8b1e3f;"></div>
                <span>Favorite</span>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-card-value" id="countriesExplored">0</div>
                <div class="stat-card-label">Countries Explored</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-value" id="totalCoffees">0</div>
                <div class="stat-card-label">Total Coffees</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-value" id="avgRating">0.0</div>
                <div class="stat-card-label">Average Rating</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-value" id="topOrigin">--</div>
                <div class="stat-card-label">Top Origin</div>
            </div>
        </div>
    </div>

    <script>
        // Coffee producing countries with data
        const coffeeData = {
            'Ethiopia': {
                tried: true,
                favorite: true,
                coffees: 12,
                avgRating: 4.6,
                processing: ['natural', 'washed', 'honey'],
                flavors: ['floral', 'fruity', 'bright', 'complex'],
                coords: { x: 580, y: 280 }
            },
            'Colombia': {
                tried: true,
                favorite: false,
                coffees: 8,
                avgRating: 4.3,
                processing: ['washed', 'honey'],
                flavors: ['chocolate', 'caramel', 'balanced', 'nutty'],
                coords: { x: 280, y: 280 }
            },
            'Brazil': {
                tried: true,
                favorite: false,
                coffees: 6,
                avgRating: 4.0,
                processing: ['natural', 'pulped-natural'],
                flavors: ['nutty', 'chocolate', 'sweet', 'smooth'],
                coords: { x: 330, y: 340 }
            },
            'Kenya': {
                tried: true,
                favorite: false,
                coffees: 5,
                avgRating: 4.5,
                processing: ['washed'],
                flavors: ['bright', 'citrus', 'berry', 'complex'],
                coords: { x: 580, y: 300 }
            },
            'Guatemala': {
                tried: true,
                favorite: false,
                coffees: 7,
                avgRating: 4.2,
                processing: ['washed', 'honey'],
                flavors: ['chocolate', 'spice', 'balanced', 'smooth'],
                coords: { x: 240, y: 260 }
            },
            'Costa Rica': {
                tried: true,
                favorite: false,
                coffees: 4,
                avgRating: 4.4,
                processing: ['honey', 'washed'],
                flavors: ['bright', 'citrus', 'honey', 'clean'],
                coords: { x: 250, y: 270 }
            },
            'Indonesia': {
                tried: false,
                favorite: false,
                coffees: 0,
                avgRating: 0,
                processing: ['wet-hulled', 'natural'],
                flavors: ['earthy', 'herbal', 'spicy', 'full-bodied'],
                coords: { x: 750, y: 310 }
            },
            'Vietnam': {
                tried: false,
                favorite: false,
                coffees: 0,
                avgRating: 0,
                processing: ['natural', 'washed'],
                flavors: ['chocolate', 'nutty', 'strong'],
                coords: { x: 720, y: 260 }
            }
        };

        // Simplified world map paths (coffee belt region focus)
        const countries = {
            'Ethiopia': 'M580,270 l15,5 l5,15 l-10,10 l-15,-5 l-5,-15 z',
            'Kenya': 'M580,295 l12,5 l3,12 l-10,8 l-12,-5 l-3,-12 z',
            'Colombia': 'M280,270 l20,8 l8,20 l-15,15 l-20,-8 l-8,-20 z',
            'Brazil': 'M330,320 l30,10 l10,30 l-25,25 l-30,-10 l-10,-30 z',
            'Guatemala': 'M240,255 l15,5 l5,15 l-12,10 l-15,-5 l-5,-15 z',
            'Costa Rica': 'M250,265 l12,4 l4,12 l-10,8 l-12,-4 l-4,-12 z',
            'Indonesia': 'M750,300 l25,8 l8,20 l-20,15 l-25,-8 l-8,-20 z',
            'Vietnam': 'M720,255 l18,6 l6,18 l-15,12 l-18,-6 l-6,-18 z'
        };

        let showJourney = false;
        let showLabels = true;

        function initMap() {
            const svg = document.getElementById('worldMap');
            svg.innerHTML = '';

            // Draw background (ocean)
            const ocean = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            ocean.setAttribute('width', '1000');
            ocean.setAttribute('height', '500');
            ocean.setAttribute('fill', '#e8f4f0');
            svg.appendChild(ocean);

            // Draw equator line
            const equator = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            equator.setAttribute('x1', '0');
            equator.setAttribute('y1', '250');
            equator.setAttribute('x2', '1000');
            equator.setAttribute('y2', '250');
            equator.setAttribute('stroke', '#c4b5a0');
            equator.setAttribute('stroke-width', '1');
            equator.setAttribute('stroke-dasharray', '5,5');
            equator.setAttribute('opacity', '0.5');
            svg.appendChild(equator);

            // Draw journey lines first (so they appear behind countries)
            if (showJourney) {
                const triedCountries = Object.entries(coffeeData)
                    .filter(([_, data]) => data.tried)
                    .sort((a, b) => a[1].avgRating - b[1].avgRating);

                for (let i = 0; i < triedCountries.length - 1; i++) {
                    const from = triedCountries[i][1].coords;
                    const to = triedCountries[i + 1][1].coords;

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', from.x);
                    line.setAttribute('y1', from.y);
                    line.setAttribute('x2', to.x);
                    line.setAttribute('y2', to.y);
                    line.setAttribute('class', 'journey-line');
                    svg.appendChild(line);
                }
            }

            // Draw countries
            Object.entries(countries).forEach(([name, path]) => {
                const data = coffeeData[name];

                const country = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                country.setAttribute('d', path);
                country.setAttribute('class', 'country producing' +
                    (data.tried ? ' tried' : '') +
                    (data.favorite ? ' favorite' : ''));
                country.setAttribute('data-country', name);

                country.addEventListener('click', () => showCountryInfo(name));
                country.addEventListener('mouseenter', (e) => showCountryInfo(name, e));
                country.addEventListener('mouseleave', hideCountryInfo);

                svg.appendChild(country);

                // Add label if enabled
                if (showLabels && data.coords) {
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', data.coords.x);
                    label.setAttribute('y', data.coords.y - 20);
                    label.setAttribute('class', 'country-label');
                    label.textContent = name;
                    svg.appendChild(label);

                    // Add coffee count badge for tried countries
                    if (data.tried) {
                        const badge = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        badge.setAttribute('cx', data.coords.x + name.length * 3);
                        badge.setAttribute('cy', data.coords.y - 24);
                        badge.setAttribute('r', '8');
                        badge.setAttribute('fill', '#d4af37');
                        badge.setAttribute('stroke', '#2b1810');
                        badge.setAttribute('stroke-width', '1.5');
                        svg.appendChild(badge);

                        const count = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        count.setAttribute('x', data.coords.x + name.length * 3);
                        count.setAttribute('y', data.coords.y - 24);
                        count.setAttribute('text-anchor', 'middle');
                        count.setAttribute('dominant-baseline', 'middle');
                        count.setAttribute('fill', '#2b1810');
                        count.setAttribute('font-size', '10');
                        count.setAttribute('font-weight', 'bold');
                        count.textContent = data.coffees;
                        svg.appendChild(count);
                    }
                }
            });

            updateStats();
        }

        function showCountryInfo(countryName, event) {
            const data = coffeeData[countryName];
            const card = document.getElementById('infoCard');

            const statusIcon = data.favorite ? '⭐' : data.tried ? '✓' : '○';

            card.innerHTML = `
                <h3>${statusIcon} ${countryName}</h3>
                ${data.tried ? `
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">${data.coffees}</div>
                            <div class="stat-label">Coffees Tried</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${data.avgRating.toFixed(1)}</div>
                            <div class="stat-label">Avg Rating</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <strong style="color: #d4af37;">Processing Methods:</strong><br>
                        <div style="margin-top: 0.5rem;">
                            ${data.processing.map(p => `<span class="flavor-tag">${p}</span>`).join('')}
                        </div>
                    </div>
                    <div class="flavors">
                        <strong style="color: #d4af37;">Flavor Profile:</strong><br>
                        <div style="margin-top: 0.5rem;">
                            ${data.flavors.map(f => `<span class="flavor-tag">${f}</span>`).join('')}
                        </div>
                    </div>
                ` : `
                    <p style="margin-top: 1rem;">Coffee producing region - not yet explored in your vault.</p>
                    <div style="margin-top: 1rem;">
                        <strong style="color: #d4af37;">Typical Flavors:</strong><br>
                        <div style="margin-top: 0.5rem;">
                            ${data.flavors.map(f => `<span class="flavor-tag">${f}</span>`).join('')}
                        </div>
                    </div>
                `}
            `;

            if (event) {
                card.style.left = Math.min(event.clientX + 20, window.innerWidth - 370) + 'px';
                card.style.top = event.clientY + 20 + 'px';
            } else {
                card.style.left = '50%';
                card.style.top = '50%';
                card.style.transform = 'translate(-50%, -50%)';
            }

            card.classList.add('visible');
        }

        function hideCountryInfo() {
            document.getElementById('infoCard').classList.remove('visible');
        }

        function updateStats() {
            const tried = Object.values(coffeeData).filter(d => d.tried);

            document.getElementById('countriesExplored').textContent = tried.length;

            const totalCoffees = tried.reduce((sum, d) => sum + d.coffees, 0);
            document.getElementById('totalCoffees').textContent = totalCoffees;

            const avgRating = tried.length > 0
                ? (tried.reduce((sum, d) => sum + (d.avgRating * d.coffees), 0) / totalCoffees).toFixed(1)
                : '0.0';
            document.getElementById('avgRating').textContent = avgRating;

            const topOrigin = tried.length > 0
                ? Object.entries(coffeeData)
                    .filter(([_, d]) => d.tried)
                    .reduce((max, [name, d]) => d.avgRating > max.rating ? { name, rating: d.avgRating } : max, { name: '--', rating: 0 })
                : { name: '--' };
            document.getElementById('topOrigin').textContent = topOrigin.name;
        }

        // Event listeners
        document.getElementById('toggleJourney').addEventListener('click', function() {
            showJourney = !showJourney;
            this.classList.toggle('active');
            initMap();
        });

        document.getElementById('toggleLabels').addEventListener('click', function() {
            showLabels = !showLabels;
            this.classList.toggle('active');
            initMap();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            hideCountryInfo();
        });

        // API for Obsidian integration
        window.OriginMap = {
            setData: (data) => {
                Object.assign(coffeeData, data);
                initMap();
            },
            getData: () => coffeeData,
            highlightCountry: (countryName) => {
                showCountryInfo(countryName);
            },
            reset: () => {
                showJourney = false;
                showLabels = true;
                document.getElementById('toggleJourney').classList.remove('active');
                document.getElementById('toggleLabels').classList.add('active');
                initMap();
            }
        };

        // Initialize
        initMap();
    </script>
</body>
</html>